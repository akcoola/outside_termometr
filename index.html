<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä ThingSpeak</title>
    <meta name="theme-color" content="#0a192f">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icons/icon-192.png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Arial', sans-serif;
        }

        body {
            background: linear-gradient(135deg, #0a192f 0%, #112240 100%);
            color: #e6f1ff;
            min-height: 100vh;
            overflow-x: hidden;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(17, 34, 64, 0.7);
            border-radius: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(100, 255, 218, 0.1);
        }

        h1 {
            font-size: 2.5rem;
            background: linear-gradient(90deg, #64ffda, #57cbff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
            text-shadow: 0 0 30px rgba(100, 255, 218, 0.3);
        }

        .subtitle {
            font-size: 1.1rem;
            opacity: 0.8;
        }

        /* –§–æ—Ä–º–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ */
        .config-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(10, 25, 47, 0.95);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            backdrop-filter: blur(10px);
        }

        .config-form {
            background: rgba(17, 34, 64, 0.9);
            padding: 40px;
            border-radius: 20px;
            max-width: 500px;
            width: 90%;
            border: 1px solid rgba(100, 255, 218, 0.2);
            box-shadow: 0 0 50px rgba(100, 255, 218, 0.1);
        }

        .config-form h2 {
            color: #64ffda;
            margin-bottom: 20px;
            text-align: center;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #8892b0;
        }

        .form-group input {
            width: 100%;
            padding: 12px 15px;
            background: rgba(10, 25, 47, 0.5);
            border: 1px solid rgba(100, 255, 218, 0.3);
            border-radius: 10px;
            color: #e6f1ff;
            font-size: 1rem;
        }

        .form-group input:focus {
            outline: none;
            border-color: #64ffda;
            box-shadow: 0 0 10px rgba(100, 255, 218, 0.2);
        }

        .form-buttons {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }

        .btn {
            padding: 12px 25px;
            border-radius: 10px;
            border: none;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            flex: 1;
            transition: all 0.3s;
        }

        .btn-primary {
            background: linear-gradient(135deg, #64ffda, #57cbff);
            color: #0a192f;
        }

        .btn-secondary {
            background: transparent;
            color: #64ffda;
            border: 1px solid rgba(100, 255, 218, 0.3);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(100, 255, 218, 0.2);
        }

        /* –û—Å–Ω–æ–≤–Ω–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ */
        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        @media (max-width: 900px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }

        /* –ü–∞–Ω–µ–ª—å —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã */
        .temperature-panel {
            background: rgba(17, 34, 64, 0.7);
            border-radius: 20px;
            padding: 40px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(100, 255, 218, 0.1);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 400px;
        }

        .temperature-display {
            text-align: center;
            margin-bottom: 40px;
        }

        .temp-value {
            font-size: 6rem;
            font-weight: 800;
            background: linear-gradient(90deg, #64ffda, #57cbff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            line-height: 1;
            margin-bottom: 20px;
            text-shadow: 0 0 20px rgba(100, 255, 218, 0.3);
        }

        .temp-unit {
            font-size: 3rem;
            opacity: 0.7;
            vertical-align: top;
        }

        .temp-status {
            font-size: 1.8rem;
            color: #64ffda;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }

        .temp-meta {
            display: flex;
            gap: 30px;
            margin-top: 20px;
        }

        .temp-meta-item {
            text-align: center;
        }

        .meta-label {
            font-size: 0.9rem;
            opacity: 0.7;
            margin-bottom: 5px;
        }

        .meta-value {
            font-size: 1.5rem;
            font-weight: 600;
            color: #57cbff;
        }

        /* –ü–∞–Ω–µ–ª—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ */
        .info-panel {
            background: rgba(17, 34, 64, 0.7);
            border-radius: 20px;
            padding: 30px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(100, 255, 218, 0.1);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        /* –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: rgba(10, 25, 47, 0.5);
            padding: 20px;
            border-radius: 15px;
            border: 1px solid rgba(100, 255, 218, 0.1);
            transition: all 0.3s;
        }

        .stat-card:hover {
            border-color: #64ffda;
            transform: translateY(-5px);
        }

        .stat-label {
            font-size: 0.9rem;
            opacity: 0.7;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 600;
            color: #64ffda;
        }

        /* –ì—Ä–∞—Ñ–∏–∫ */
        .chart-container {
            height: 250px;
            background: rgba(10, 25, 47, 0.5);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
            position: relative;
            overflow: hidden;
        }

        .chart-title {
            position: absolute;
            top: 10px;
            left: 15px;
            font-size: 0.9rem;
            opacity: 0.7;
        }

        #temperatureChart {
            width: 100%;
            height: 100%;
        }

        /* –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è */
        .action-buttons {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }

        .action-btn {
            padding: 15px;
            border-radius: 12px;
            border: none;
            background: linear-gradient(135deg, #0a192f, #112240);
            color: #64ffda;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            border: 1px solid rgba(100, 255, 218, 0.3);
            transition: all 0.3s;
        }

        .action-btn:hover {
            background: linear-gradient(135deg, #112240, #0a192f);
            border-color: #64ffda;
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(100, 255, 218, 0.1);
        }

        /* –ê–Ω–∏–º–∞—Ü–∏–∏ */
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .fade-in {
            animation: fadeIn 0.5s ease-out;
        }

        /* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è */
        .connection-status {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 8px;
            z-index: 100;
            backdrop-filter: blur(10px);
        }

        .connected {
            background: rgba(46, 204, 113, 0.2);
            border: 1px solid rgba(46, 204, 113, 0.5);
            color: #2ecc71;
        }

        .disconnected {
            background: rgba(231, 76, 60, 0.2);
            border: 1px solid rgba(231, 76, 60, 0.5);
            color: #e74c3c;
        }

        /* –ú–æ–±–∏–ª—å–Ω–∞—è –∞–¥–∞–ø—Ç–∞—Ü–∏—è */
        @media (max-width: 768px) {
            h1 {
                font-size: 2rem;
            }
            
            .temp-value {
                font-size: 4rem;
            }
            
            .temp-unit {
                font-size: 2rem;
            }
            
            .temp-status {
                font-size: 1.4rem;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .action-buttons {
                grid-template-columns: 1fr;
            }
            
            .config-form {
                padding: 20px;
            }
            
            .temp-meta {
                flex-direction: column;
                gap: 15px;
            }
        }

        /* –í—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è */
        .last-update {
            text-align: center;
            margin-top: 20px;
            font-size: 0.9rem;
            opacity: 0.7;
        }

        /* –¶–≤–µ—Ç–æ–≤—ã–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã */
        .temp-cold {
            color: #3498db;
        }

        .temp-cool {
            color: #2ecc71;
        }

        .temp-mild {
            color: #f1c40f;
        }

        .temp-warm {
            color: #e67e22;
        }

        .temp-hot {
            color: #e74c3c;
        }

        .temp-extreme {
            color: #c0392b;
        }
    </style>
</head>
<body>
    <!-- –§–æ—Ä–º–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ -->
    <div id="configOverlay" class="config-overlay" style="display: none;">
        <div class="config-form">
            <h2><i class="fas fa-cog"></i> –ù–∞—Å—Ç—Ä–æ–π–∫–∏ ThingSpeak</h2>
            <p style="color: #8892b0; margin-bottom: 25px; text-align: center;">
                –í–≤–µ–¥–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –≤–∞—à–µ–º—É –∫–∞–Ω–∞–ª—É ThingSpeak
            </p>
            
            <div class="form-group">
                <label for="channelId"><i class="fas fa-hashtag"></i> Channel ID</label>
                <input type="text" id="channelId" placeholder="–í–≤–µ–¥–∏—Ç–µ Channel ID">
            </div>
            
            <div class="form-group">
                <label for="apiKey"><i class="fas fa-key"></i> Read API Key</label>
                <input type="text" id="apiKey" placeholder="–í–≤–µ–¥–∏—Ç–µ Read API Key">
            </div>
            
            <div class="form-group">
                <label for="fieldNumber"><i class="fas fa-sort-numeric-up"></i> –ù–æ–º–µ—Ä –ø–æ–ª—è</label>
                <input type="number" id="fieldNumber" value="3" min="1" max="8">
                <small style="color: #8892b0; font-size: 0.8rem;">–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è field3</small>
            </div>
            
            <div class="form-buttons">
                <button type="button" class="btn btn-secondary" id="cancelBtn">
                    <i class="fas fa-times"></i> –û—Ç–º–µ–Ω–∞
                </button>
                <button type="button" class="btn btn-primary" id="saveConfigBtn">
                    <i class="fas fa-save"></i> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                </button>
            </div>
        </div>
    </div>

    <div class="container">
        <header>
            <h1><i class="fas fa-temperature-high"></i> –¢–ï–ú–ü–ï–†–ê–¢–£–†–ù–´–ô –ú–û–ù–ò–¢–û–†</h1>
            <p class="subtitle">–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã —Å ThingSpeak –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏</p>
        </header>

        <div class="main-content">
            <div class="temperature-panel">
                <div class="temperature-display">
                    <div class="temp-value">
                        <span id="tempValue">--</span><span class="temp-unit">¬∞C</span>
                    </div>
                    <div class="temp-status" id="tempStatus">
                        <i class="fas fa-thermometer-half"></i> <span>–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ ThingSpeak...</span>
                    </div>
                    
                    <div class="temp-meta">
                        <div class="temp-meta-item">
                            <div class="meta-label">–í–ª–∞–∂–Ω–æ—Å—Ç—å</div>
                            <div class="meta-value" id="humidityValue">--%</div>
                        </div>
                        <div class="temp-meta-item">
                            <div class="meta-label">–î–∞–≤–ª–µ–Ω–∏–µ</div>
                            <div class="meta-value" id="pressureValue">-- hPa</div>
                        </div>
                        <div class="temp-meta-item">
                            <div class="meta-label">–í—Ä–µ–º—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è</div>
                            <div class="meta-value" id="updateTime">--:--</div>
                        </div>
                    </div>
                </div>
                
                <div class="last-update" id="lastUpdate">
                    –ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: –∑–∞–≥—Ä—É–∑–∫–∞...
                </div>
            </div>

            <div class="info-panel">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">
                            <i class="fas fa-temperature-low"></i> –ú–∏–Ω. –∑–∞ —Å—É—Ç–∫–∏
                        </div>
                        <div class="stat-value" id="minTemp">--¬∞C</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">
                            <i class="fas fa-temperature-high"></i> –ú–∞–∫—Å. –∑–∞ —Å—É—Ç–∫–∏
                        </div>
                        <div class="stat-value" id="maxTemp">--¬∞C</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">
                            <i class="fas fa-chart-line"></i> –ò–∑–º–µ–Ω–µ–Ω–∏–µ –∑–∞ —á–∞—Å
                        </div>
                        <div class="stat-value" id="tempChange">--¬∞C</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">
                            <i class="fas fa-trend-up"></i> –¢–µ–Ω–¥–µ–Ω—Ü–∏—è
                        </div>
                        <div class="stat-value" id="tempTrend">--</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">
                            <i class="fas fa-arrows-alt-v"></i> –î–∏–∞–ø–∞–∑–æ–Ω
                        </div>
                        <div class="stat-value" id="tempRange">--¬∞C</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">
                            <i class="fas fa-clock"></i> –°—Ä–µ–¥–Ω—è—è –∑–∞ –¥–µ–Ω—å
                        </div>
                        <div class="stat-value" id="avgTemp">--¬∞C</div>
                    </div>
                </div>

                <div class="chart-container">
                    <div class="chart-title">–ò—Å—Ç–æ—Ä–∏—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã (24—á)</div>
                    <canvas id="temperatureChart"></canvas>
                </div>

                <div class="action-buttons">
                    <button class="action-btn" id="refreshBtn">
                        <i class="fas fa-sync-alt"></i> –û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ
                    </button>
                    <button class="action-btn" id="settingsBtn">
                        <i class="fas fa-cog"></i> –ù–∞—Å—Ç—Ä–æ–π–∫–∏
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è -->
    <div id="connectionStatus" class="connection-status disconnected">
        <i class="fas fa-plug"></i>
        <span>–û—Ç–∫–ª—é—á–µ–Ω–æ</span>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è PWA
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('sw.js').catch(err => {
                    console.log('Service Worker —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–µ —É–¥–∞–ª–∞—Å—å:', err);
                });
            });
        }

        // –ú–∞–Ω–∏—Ñ–µ—Å—Ç PWA
        const manifest = {
            "name": "–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä",
            "short_name": "–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞",
            "description": "–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã —Å ThingSpeak",
            "start_url": "/",
            "display": "standalone",
            "background_color": "#0a192f",
            "theme_color": "#0a192f",
            "icons": [
                {
                    "src": "icons/icon-72.png",
                    "sizes": "72x72",
                    "type": "image/png"
                },
                {
                    "src": "icons/icon-96.png",
                    "sizes": "96x96",
                    "type": "image/png"
                },
                {
                    "src": "icons/icon-128.png",
                    "sizes": "128x128",
                    "type": "image/png"
                },
                {
                    "src": "icons/icon-144.png",
                    "sizes": "144x144",
                    "type": "image/png"
                },
                {
                    "src": "icons/icon-192.png",
                    "sizes": "192x192",
                    "type": "image/png"
                },
                {
                    "src": "icons/icon-512.png",
                    "sizes": "512x512",
                    "type": "image/png"
                }
            ]
        };

        // –î–∞–Ω–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        let currentTemp = null;
        let tempHistory = [];
        let config = {
            channelId: '',
            apiKey: '',
            fieldNumber: 3
        };
        let isConnected = false;
        let lastUpdateTime = null;
        
        // DOM —ç–ª–µ–º–µ–Ω—Ç—ã
        const configOverlay = document.getElementById('configOverlay');
        const channelIdInput = document.getElementById('channelId');
        const apiKeyInput = document.getElementById('apiKey');
        const fieldNumberInput = document.getElementById('fieldNumber');
        const saveConfigBtn = document.getElementById('saveConfigBtn');
        const cancelBtn = document.getElementById('cancelBtn');
        const settingsBtn = document.getElementById('settingsBtn');
        const tempValue = document.getElementById('tempValue');
        const tempStatus = document.getElementById('tempStatus');
        const minTempEl = document.getElementById('minTemp');
        const maxTempEl = document.getElementById('maxTemp');
        const tempChangeEl = document.getElementById('tempChange');
        const tempTrendEl = document.getElementById('tempTrend');
        const tempRangeEl = document.getElementById('tempRange');
        const avgTempEl = document.getElementById('avgTemp');
        const refreshBtn = document.getElementById('refreshBtn');
        const connectionStatus = document.getElementById('connectionStatus');
        const humidityValue = document.getElementById('humidityValue');
        const pressureValue = document.getElementById('pressureValue');
        const updateTime = document.getElementById('updateTime');
        const lastUpdate = document.getElementById('lastUpdate');
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≥—Ä–∞—Ñ–∏–∫–∞
        let tempChart;
        function initChart() {
            const ctx = document.getElementById('temperatureChart').getContext('2d');
            
            tempChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: Array.from({length: 24}, (_, i) => `${i}:00`),
                    datasets: [{
                        label: '–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ ¬∞C',
                        data: Array(24).fill(null),
                        borderColor: '#64ffda',
                        backgroundColor: 'rgba(100, 255, 218, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4,
                        pointBackgroundColor: '#57cbff',
                        pointBorderColor: '#ffffff',
                        pointBorderWidth: 2,
                        pointRadius: 5
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            backgroundColor: 'rgba(10, 25, 47, 0.9)',
                            titleColor: '#64ffda',
                            bodyColor: '#e6f1ff',
                            borderColor: '#64ffda',
                            borderWidth: 1
                        }
                    },
                    scales: {
                        x: {
                            grid: { color: 'rgba(100, 255, 218, 0.1)' },
                            ticks: { color: '#8892b0' }
                        },
                        y: {
                            grid: { color: 'rgba(100, 255, 218, 0.1)' },
                            ticks: { color: '#8892b0' }
                        }
                    }
                }
            });
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∏–∑ localStorage
        function loadConfig() {
            const savedConfig = localStorage.getItem('thermometerConfig');
            if (savedConfig) {
                config = JSON.parse(savedConfig);
                channelIdInput.value = config.channelId;
                apiKeyInput.value = config.apiKey;
                fieldNumberInput.value = config.fieldNumber;
                return true;
            }
            return false;
        }
        
        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
        function saveConfig() {
            config = {
                channelId: channelIdInput.value.trim(),
                apiKey: apiKeyInput.value.trim(),
                fieldNumber: parseInt(fieldNumberInput.value) || 3
            };
            
            if (!config.channelId || !config.apiKey) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è');
                return;
            }
            
            localStorage.setItem('thermometerConfig', JSON.stringify(config));
            configOverlay.style.display = 'none';
            fetchTemperature(); // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ—Å–ª–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫
        }
        
        // –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ ThingSpeak
        async function fetchTemperature() {
            if (!config.channelId || !config.apiKey) {
                showConfigForm();
                return;
            }
            
            try {
                updateConnectionStatus(false, '–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ...');
                
                // –ü–æ–ª—É—á–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–µ –¥–∞–Ω–Ω—ã–µ
                const lastUrl = `https://api.thingspeak.com/channels/${config.channelId}/fields/${config.fieldNumber}/last.json?api_key=${config.apiKey}`;
                const lastResponse = await fetch(lastUrl);
                
                if (!lastResponse.ok) {
                    throw new Error('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏');
                }
                
                const lastData = await lastResponse.json();
                
                if (lastData[`field${config.fieldNumber}`] === null || lastData[`field${config.fieldNumber}`] === undefined) {
                    throw new Error('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –≤ –ø–æ–ª–µ');
                }
                
                currentTemp = parseFloat(lastData[`field${config.fieldNumber}`]);
                lastUpdateTime = new Date();
                isConnected = true;
                updateConnectionStatus(true, '–ü–æ–¥–∫–ª—é—á–µ–Ω–æ –∫ ThingSpeak');
                updateDisplay(currentTemp);
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Ä–µ–º—è
                updateTimeDisplay();
                
                // –ü–æ–ª—É—á–∞–µ–º –∏—Å—Ç–æ—Ä–∏—é –¥–∞–Ω–Ω—ã—Ö
                await fetchHistory();
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å
                updateTempStatus(currentTemp);
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö:', error);
                isConnected = false;
                updateConnectionStatus(false, '–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è');
                
                // –î–µ–º–æ-—Ä–µ–∂–∏–º –ø—Ä–∏ –æ—à–∏–±–∫–µ
                if (!currentTemp) {
                    currentTemp = 20 + (Math.random() - 0.5) * 10;
                    updateDisplay(currentTemp);
                    updateTempStatus(currentTemp);
                }
            }
        }
        
        // –ü–æ–ª—É—á–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ –¥–∞–Ω–Ω—ã—Ö
        async function fetchHistory() {
            try {
                const url = `https://api.thingspeak.com/channels/${config.channelId}/fields/${config.fieldNumber}.json?results=24&api_key=${config.apiKey}`;
                const response = await fetch(url);
                const data = await response.json();
                
                if (data.feeds && data.feeds.length > 0) {
                    tempHistory = data.feeds.map(feed => {
                        const temp = parseFloat(feed[`field${config.fieldNumber}`]);
                        return !isNaN(temp) ? temp : null;
                    }).filter(val => val !== null);
                    
                    if (tempHistory.length > 0) {
                        updateChart();
                        updateStats();
                    }
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–∏:', error);
            }
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã
        function updateDisplay(temp) {
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ü–∏—Ñ—Ä–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
            tempValue.textContent = temp.toFixed(1);
            
            // –î–æ–±–∞–≤–ª—è–µ–º —Ü–≤–µ—Ç–æ–≤–æ–π –∫–ª–∞—Å—Å –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã
            tempValue.className = 'temp-value';
            if (temp < -10) tempValue.classList.add('temp-cold');
            else if (temp < 0) tempValue.classList.add('temp-cool');
            else if (temp < 15) tempValue.classList.add('temp-mild');
            else if (temp < 25) tempValue.classList.add('temp-warm');
            else if (temp < 35) tempValue.classList.add('temp-hot');
            else tempValue.classList.add('temp-extreme');
            
            // –≠—Ñ—Ñ–µ–∫—Ç –ø—É–ª—å—Å–∞—Ü–∏–∏
            tempValue.classList.add('pulse');
            setTimeout(() => {
                tempValue.classList.remove('pulse');
            }, 1000);
            
            // –≠—Ñ—Ñ–µ–∫—Ç –ø–æ—è–≤–ª–µ–Ω–∏—è
            tempValue.classList.add('fade-in');
            setTimeout(() => {
                tempValue.classList.remove('fade-in');
            }, 500);
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã
        function updateTempStatus(temp) {
            let statusText, statusIcon, statusColor;
            
            if (temp < -10) {
                statusText = '–≠–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω—ã–π —Ö–æ–ª–æ–¥';
                statusIcon = '‚ùÑÔ∏è';
                statusColor = '#3498db';
            } else if (temp < 0) {
                statusText = '–ú–æ—Ä–æ–∑';
                statusIcon = '‚õÑ';
                statusColor = '#2ecc71';
            } else if (temp < 15) {
                statusText = '–ü—Ä–æ—Ö–ª–∞–¥–Ω–æ';
                statusIcon = 'üçÉ';
                statusColor = '#f1c40f';
            } else if (temp < 25) {
                statusText = '–ö–æ–º—Ñ–æ—Ä—Ç–Ω–æ';
                statusIcon = 'üòä';
                statusColor = '#e67e22';
            } else if (temp < 35) {
                statusText = '–¢–µ–ø–ª–æ';
                statusIcon = '‚òÄÔ∏è';
                statusColor = '#e74c3c';
            } else {
                statusText = '–ñ–∞—Ä–∞';
                statusIcon = 'üî•';
                statusColor = '#c0392b';
            }
            
            tempStatus.innerHTML = `${statusIcon} ${statusText}`;
            tempStatus.style.color = statusColor;
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–∞
        function updateChart() {
            if (tempHistory.length > 0) {
                tempChart.data.datasets[0].data = [...tempHistory];
                tempChart.update();
            }
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        function updateStats() {
            if (tempHistory.length > 0) {
                const min = Math.min(...tempHistory);
                const max = Math.max(...tempHistory);
                const change = tempHistory.length > 1 ? 
                    tempHistory[tempHistory.length - 1] - tempHistory[tempHistory.length - 2] : 0;
                const range = max - min;
                const avg = tempHistory.reduce((a, b) => a + b, 0) / tempHistory.length;
                
                minTempEl.textContent = `${min.toFixed(1)}¬∞C`;
                maxTempEl.textContent = `${max.toFixed(1)}¬∞C`;
                tempChangeEl.textContent = `${change >= 0 ? '+' : ''}${change.toFixed(1)}¬∞C`;
                tempChangeEl.style.color = change >= 0 ? '#2ecc71' : '#e74c3c';
                tempRangeEl.textContent = `${range.toFixed(1)}¬∞C`;
                avgTempEl.textContent = `${avg.toFixed(1)}¬∞C`;
                
                let trend = '–°—Ç–∞–±–∏–ª—å–Ω–æ';
                let trendIcon = '='; 
                if (change > 0.5) {
                    trend = '–†–∞—Å—Ç—ë—Ç';
                    trendIcon = '‚Üó';
                } else if (change < -0.5) {
                    trend = '–ü–∞–¥–∞–µ—Ç';
                    trendIcon = '‚Üò';
                }
                tempTrendEl.innerHTML = `${trendIcon} ${trend}`;
                
                // –î–µ–º–æ-–¥–∞–Ω–Ω—ã–µ –¥–ª—è –≤–ª–∞–∂–Ω–æ—Å—Ç–∏ –∏ –¥–∞–≤–ª–µ–Ω–∏—è
                humidityValue.textContent = `${Math.round(40 + Math.random() * 40)}%`;
                pressureValue.textContent = `${Math.round(980 + Math.random() * 40)} hPa`;
            }
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏
        function updateTimeDisplay() {
            if (lastUpdateTime) {
                const now = new Date();
                const timeStr = lastUpdateTime.toLocaleTimeString('ru-RU', {
                    hour: '2-digit',
                    minute: '2-digit',
                    second: '2-digit'
                });
                
                updateTime.textContent = timeStr;
                
                // –í—ã—á–∏—Å–ª—è–µ–º –≤—Ä–µ–º—è —Å –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
                const diff = Math.floor((now - lastUpdateTime) / 1000);
                let timeAgo;
                
                if (diff < 60) {
                    timeAgo = `${diff} —Å–µ–∫ –Ω–∞–∑–∞–¥`;
                } else if (diff < 3600) {
                    timeAgo = `${Math.floor(diff / 60)} –º–∏–Ω –Ω–∞–∑–∞–¥`;
                } else {
                    timeAgo = `${Math.floor(diff / 3600)} —á –Ω–∞–∑–∞–¥`;
                }
                
                lastUpdate.textContent = `–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: ${timeAgo}`;
            }
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
        function updateConnectionStatus(connected, message) {
            isConnected = connected;
            connectionStatus.className = `connection-status ${connected ? 'connected' : 'disconnected'}`;
            connectionStatus.innerHTML = `<i class="fas fa-${connected ? 'plug' : 'plug'}"></i> <span>${message}</span>`;
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å —Ñ–æ—Ä–º—É –Ω–∞—Å—Ç—Ä–æ–µ–∫
        function showConfigForm() {
            configOverlay.style.display = 'flex';
        }
        
        // –°–∫—Ä—ã—Ç—å —Ñ–æ—Ä–º—É –Ω–∞—Å—Ç—Ä–æ–µ–∫
        function hideConfigForm() {
            configOverlay.style.display = 'none';
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        function initApp() {
            initChart();
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
            const hasConfig = loadConfig();
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ñ–æ—Ä–º—É –Ω–∞—Å—Ç—Ä–æ–µ–∫ –µ—Å–ª–∏ –Ω–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
            if (!hasConfig) {
                showConfigForm();
            } else {
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –µ—Å–ª–∏ –µ—Å—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
                fetchTemperature();
            }
            
            // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
            saveConfigBtn.addEventListener('click', saveConfig);
            cancelBtn.addEventListener('click', hideConfigForm);
            settingsBtn.addEventListener('click', showConfigForm);
            refreshBtn.addEventListener('click', fetchTemperature);
            
            // –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
            setInterval(() => {
                if (isConnected) {
                    fetchTemperature();
                }
            }, 30000);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Ä–µ–º—è –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É
            setInterval(updateTimeDisplay, 1000);
            
            // –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–¥–¥–µ—Ä–∂–∫—É —É—Å—Ç–∞–Ω–æ–≤–∫–∏ PWA
            let deferredPrompt;
            window.addEventListener('beforeinstallprompt', (e) => {
                e.preventDefault();
                deferredPrompt = e;
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É —É—Å—Ç–∞–Ω–æ–≤–∫–∏
                const installBtn = document.createElement('button');
                installBtn.className = 'action-btn';
                installBtn.innerHTML = '<i class="fas fa-download"></i> –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ';
                installBtn.style.marginTop = '15px';
                installBtn.addEventListener('click', () => {
                    deferredPrompt.prompt();
                    deferredPrompt.userChoice.then((choiceResult) => {
                        if (choiceResult.outcome === 'accepted') {
                            console.log('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É—Å—Ç–∞–Ω–æ–≤–∏–ª –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ');
                        }
                        deferredPrompt = null;
                    });
                });
                
                document.querySelector('.action-buttons').appendChild(installBtn);
            });
        }
        
        // –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        window.addEventListener('load', initApp);
    </script>
</body>
</html>